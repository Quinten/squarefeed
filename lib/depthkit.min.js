/* https://github.com/Quinten/depthkit.js */
var DepthKit=DepthKit||{rad:Math.PI/180,deg:180/Math.PI},DK=DepthKit;DepthKit.Vertex=function(a,c,b){this.x=a||0;this.y=c||0;this.z=b||0;this.d=this.pz=this.py=this.px=0;this.mx=a;this.my=c;this.mz=b};DepthKit.Edge=function(a,c){this.u=a||new DepthKit.Vertex;this.v=c||new DepthKit.Vertex;this.faces=[]};DepthKit.Edge.prototype.isBehindCamera=function(){return 0>this.u.pz||0>this.v.pz};
DepthKit.Face=function(a,c,b,d){this.a=a||new DepthKit.Vertex;this.b=c||new DepthKit.Vertex;this.c=b||new DepthKit.Vertex;this.color=d||"#cccccc";this.light=void 0;this.edges=[];this.dWeight=0};DepthKit.Face.prototype.isBackface=function(){return(this.c.px-this.a.px)*(this.b.py-this.c.py)>(this.c.py-this.a.py)*(this.b.px-this.c.px)};DepthKit.Face.prototype.isBehindCamera=function(){return 0>this.a.pz||0>this.b.pz||0>this.c.pz};
DepthKit.Face.prototype.getDepth=function(){return Math.min(this.a.d-this.dWeight,this.b.d-this.dWeight,this.c.d-this.dWeight)};DepthKit.faceSort=function(a,c){return c.getDepth()-a.getDepth()};DepthKit.Face.prototype.getAdjustedColor=function(){if(void 0===this.light)return this.color;var a=window.parseInt(this.color.slice(1),16),c=a>>16,b=a>>8&255,a=a&255,d=this.getLightFactor();return"#"+("00000"+(c*d<<16|b*d<<8|a*d|0).toString(16)).substr(-6)};
DepthKit.Face.prototype.getLightFactor=function(){var a=this.a.mx-this.b.mx,c=this.a.my-this.b.my,b=this.a.mz-this.b.mz,d=this.b.mx-this.c.mx,f=this.b.my-this.c.my,g=this.b.mz-this.c.mz,e=c*g-b*f,b=-(a*g-b*d),c=a*f-c*d,a=e*this.light.x+b*this.light.y+c*this.light.z,e=Math.sqrt(e*e+b*b+c*c),c=Math.sqrt(this.light.x*this.light.x+this.light.y*this.light.y+this.light.z*this.light.z);return Math.acos(a/(e*c))/Math.PI*this.light.brightness};
DepthKit.SceneObject=function(a,c,b){this.x=a||0;this.y=c||0;this.z=b||0;this.rotationZ=this.rotationY=this.rotationX=0;this.scaleZ=this.scaleY=this.scaleX=1;this.step=this.scene=this.parent=void 0;this.mx=a;this.my=c;this.mz=b;this.rotationMZ=this.rotationMY=this.rotationMX=0;this.scaleMZ=this.scaleMY=this.scaleMX=1};DepthKit.SceneObject.prototype.setScene=function(a){this.scene=a};DepthKit.SceneObject.prototype.getGlobalX=function(){return this.parent?this.parent.getGlobalX()+this.x:this.x};
DepthKit.SceneObject.prototype.getGlobalY=function(){return this.parent?this.parent.getGlobalY()+this.y:this.y};DepthKit.SceneObject.prototype.getGlobalZ=function(){return this.parent?this.parent.getGlobalZ()+this.z:this.z};DepthKit.SceneObject.prototype.initM=function(){};DepthKit.SceneObject.prototype.rotateM=function(){};DepthKit.SceneObject.prototype.scaleM=function(){};DepthKit.SceneObject.prototype.translateM=function(){};
DepthKit.Mesh=function(a,c,b){DepthKit.SceneObject.call(this,a,c,b);this.d=0;this.vertices=[];this.edges=[];this.faces=[];this.strokeColor="#000000";this.strokeWidth=1};DepthKit.Mesh.prototype=new DepthKit.SceneObject;DepthKit.Mesh.prototype.constructor=DepthKit.Mesh;DepthKit.Mesh.prototype.addVertex=function(a,c,b){this.vertices.push(new DepthKit.Vertex(a,c,b));return this};
DepthKit.Mesh.prototype.addEdge=function(a,c){this.edges.push(new DepthKit.Edge(a||this.vertices[this.vertices.length-2]||new DepthKit.Vertex,c||this.vertices[this.vertices.length-1]||new DepthKit.Vertex));return this};DepthKit.Mesh.prototype.addFace=function(a,c,b,d){this.faces.push(new DepthKit.Face(a||this.vertices[this.vertices.length-3]||new DepthKit.Vertex,c||this.vertices[this.vertices.length-2]||new DepthKit.Vertex,b||this.vertices[this.vertices.length-1]||new DepthKit.Vertex,d));return this};
DepthKit.Mesh.prototype.applyFillcolor=function(a){for(var c=0;c<this.faces.length;c++)this.faces[c].color=a;return this};DepthKit.Mesh.prototype.applyLight=function(a){for(var c=0;c<this.faces.length;c++)this.faces[c].light=a;return this};
DepthKit.Mesh.prototype.mergeEdgesWithFaces=function(){for(var a=0;a<this.faces.length;a++)for(var c=0;c<this.edges.length;c++)if(this.edges[c].u===this.faces[a].a&&(this.edges[c].v===this.faces[a].b||this.edges[c].v===this.faces[a].c)||this.edges[c].u===this.faces[a].b&&(this.edges[c].v===this.faces[a].a||this.edges[c].v===this.faces[a].c)||this.edges[c].u===this.faces[a].c&&(this.edges[c].v===this.faces[a].a||this.edges[c].v===this.faces[a].b))this.edges[c].faces.push(this.faces[a]),this.faces[a].edges.push(this.edges[c]);
return this};DepthKit.Mesh.prototype.rotateX=function(a){for(var c=Math.cos(a*DK.rad),a=Math.sin(a*DK.rad),b=0;b<this.vertices.length;b++){var d=this.vertices[b].z*c+this.vertices[b].y*a;this.vertices[b].y=this.vertices[b].y*c-this.vertices[b].z*a;this.vertices[b].z=d}return this};
DepthKit.Mesh.prototype.rotateY=function(a){for(var c=Math.cos(a*DK.rad),a=Math.sin(a*DK.rad),b=0;b<this.vertices.length;b++){var d=this.vertices[b].z*c+this.vertices[b].x*a;this.vertices[b].x=this.vertices[b].x*c-this.vertices[b].z*a;this.vertices[b].z=d}return this};
DepthKit.Mesh.prototype.rotateZ=function(a){for(var c=Math.cos(a*DK.rad),a=Math.sin(a*DK.rad),b=0;b<this.vertices.length;b++){var d=this.vertices[b].y*c+this.vertices[b].x*a;this.vertices[b].x=this.vertices[b].x*c-this.vertices[b].y*a;this.vertices[b].y=d}return this};
DepthKit.Mesh.prototype.setScene=function(a){if(this.scene!==a){if(void 0!==this.scene)for(var c=0;c<this.scene.meshes.length;c++)if(this.scene.meshes[c]===this){this.scene.meshes.splice(c,1);break}void 0!==a&&a.meshes.push(this);this.scene=a}};DepthKit.meshSort=function(a,c){return c.d-a.d};
DepthKit.Mesh.prototype.draw=function(a){a.save();this.faces.sort(DK.faceSort);for(var c=0;c<this.faces.length;c++)if(!this.faces[c].isBackface()&&!this.faces[c].isBehindCamera()&&(a.beginPath(),a.moveTo(this.faces[c].a.px,this.faces[c].a.py),a.lineTo(this.faces[c].b.px,this.faces[c].b.py),a.lineTo(this.faces[c].c.px,this.faces[c].c.py),a.lineTo(this.faces[c].a.px,this.faces[c].a.py),a.closePath(),a.fillStyle=a.strokeStyle=this.faces[c].getAdjustedColor(),a.lineWidth=1,a.fill(),a.stroke(),this.faces[c].edges.length)){a.strokeStyle=
this.strokeColor;a.lineWidth=this.strokeWidth;a.beginPath();for(var b=0;b<this.faces[c].edges.length;b++)a.moveTo(this.faces[c].edges[b].u.px,this.faces[c].edges[b].u.py),a.lineTo(this.faces[c].edges[b].v.px,this.faces[c].edges[b].v.py);a.stroke()}a.strokeStyle=this.strokeColor;a.lineWidth=this.strokeWidth;a.beginPath();for(c=0;c<this.edges.length;c++)0===this.edges[c].faces.length&&!this.edges[c].isBehindCamera()&&(a.moveTo(this.edges[c].u.px,this.edges[c].u.py),a.lineTo(this.edges[c].v.px,this.edges[c].v.py));
a.closePath();a.stroke();a.restore()};DepthKit.Mesh.prototype.initM=function(){this.mx=this.x;this.my=this.y;this.mz=this.z;for(var a=0;a<this.vertices.length;a++)this.vertices[a].mx=this.vertices[a].x,this.vertices[a].my=this.vertices[a].y,this.vertices[a].mz=this.vertices[a].z};
DepthKit.Mesh.prototype.rotateM=function(){this.rotationMX=this.rotationX*DK.rad+this.parent.rotationMX;this.rotationMY=this.rotationY*DK.rad+this.parent.rotationMY;this.rotationMZ=this.rotationZ*DK.rad+this.parent.rotationMZ;var a,c,b,d,f,g;if(this.rotationMX){a=Math.cos(this.rotationMX);c=Math.sin(this.rotationMX);for(b=0;b<this.vertices.length;b++)f=this.vertices[b].my*a-this.vertices[b].mz*c,g=this.vertices[b].mz*a+this.vertices[b].my*c,this.vertices[b].my=f,this.vertices[b].mz=g}if(this.rotationMY){a=
Math.cos(this.rotationMY);c=Math.sin(this.rotationMY);for(b=0;b<this.vertices.length;b++)d=this.vertices[b].mx*a-this.vertices[b].mz*c,g=this.vertices[b].mz*a+this.vertices[b].mx*c,this.vertices[b].mx=d,this.vertices[b].mz=g}if(this.rotationMZ){a=Math.cos(this.rotationMZ);c=Math.sin(this.rotationMZ);for(b=0;b<this.vertices.length;b++)d=this.vertices[b].mx*a-this.vertices[b].my*c,f=this.vertices[b].my*a+this.vertices[b].mx*c,this.vertices[b].mx=d,this.vertices[b].my=f}};
DepthKit.Mesh.prototype.translateM=function(){this.mx+=this.parent.mx;this.my+=this.parent.my;this.mz+=this.parent.mz;for(var a=0;a<this.vertices.length;a++)this.vertices[a].mx+=this.mx,this.vertices[a].my+=this.my,this.vertices[a].mz+=this.mz};DepthKit.Container=function(a,c,b){DepthKit.SceneObject.call(this,a,c,b);this.children=[]};DepthKit.Container.prototype=new DepthKit.SceneObject;DepthKit.Container.prototype.constructor=DepthKit.Container;
DepthKit.Container.prototype.rotateX=function(a){for(var c=Math.cos(a*DK.rad),b=Math.sin(a*DK.rad),d=0;d<this.children.length;d++){var f=this.children[d].z*c+this.children[d].y*b;this.children[d].y=this.children[d].y*c-this.children[d].z*b;this.children[d].z=f;this.children[d].rotateX(a)}return this};
DepthKit.Container.prototype.rotateY=function(a){for(var c=Math.cos(a*DK.rad),b=Math.sin(a*DK.rad),d=0;d<this.children.length;d++){var f=this.children[d].z*c+this.children[d].x*b;this.children[d].x=this.children[d].x*c-this.children[d].z*b;this.children[d].z=f;this.children[d].rotateY(a)}return this};
DepthKit.Container.prototype.rotateZ=function(a){for(var c=Math.cos(a*DK.rad),b=Math.sin(a*DK.rad),d=0;d<this.children.length;d++){var f=this.children[d].y*c+this.children[d].x*b;this.children[d].x=this.children[d].x*c-this.children[d].y*b;this.children[d].y=f;this.children[d].rotateZ(a)}return this};
DepthKit.Container.prototype.spinX=function(a){for(var c=Math.cos(a*DK.rad),a=Math.sin(a*DK.rad),b=0;b<this.children.length;b++){var d=this.children[b].z*c+this.children[b].y*a;this.children[b].y=this.children[b].y*c-this.children[b].z*a;this.children[b].z=d}return this};
DepthKit.Container.prototype.spinY=function(a){for(var c=Math.cos(a*DK.rad),a=Math.sin(a*DK.rad),b=0;b<this.children.length;b++){var d=this.children[b].z*c+this.children[b].x*a;this.children[b].x=this.children[b].x*c-this.children[b].z*a;this.children[b].z=d}return this};
DepthKit.Container.prototype.spinZ=function(a){for(var c=Math.cos(a*DK.rad),a=Math.sin(a*DK.rad),b=0;b<this.children.length;b++){var d=this.children[b].y*c+this.children[b].x*a;this.children[b].x=this.children[b].x*c-this.children[b].y*a;this.children[b].y=d}return this};DepthKit.Container.prototype.addChild=function(a){if(a.parent===this)return a;void 0!==a.parent&&a.parent.removeChild(a);this.children.push(a);a.parent=this;a.setScene(this.scene);return a};
DepthKit.Container.prototype.removeChildAt=function(a){if(!(a>=this.children.length)){for(var c=this.children[a];a<this.children.length-1;)this.children[a]=this.children[++a];this.children.pop();c.parent=void 0;c.setScene(void 0);return c}};DepthKit.Container.prototype.removeChild=function(a){for(var c=0;c<this.children.length;c++)if(this.children[c]===a)return this.removeChildAt(c)};DepthKit.Container.prototype.setScene=function(a){this.scene=a;for(var c=0;c<this.children.length;c++)this.children[c].setScene(a)};
DepthKit.Container.prototype.initM=function(){this.mx=this.x;this.my=this.y;this.mz=this.z;for(var a=0;a<this.children.length;a++)this.children[a].initM()};
DepthKit.Container.prototype.rotateM=function(){this.rotationMX=this.rotationX*DK.rad+this.parent.rotationMX;this.rotationMY=this.rotationY*DK.rad+this.parent.rotationMY;this.rotationMZ=this.rotationZ*DK.rad+this.parent.rotationMZ;var a,c,b,d,f,g;if(this.rotationMX){a=Math.cos(this.rotationMX);c=Math.sin(this.rotationMX);for(b=0;b<this.children.length;b++)f=this.children[b].my*a-this.children[b].mz*c,g=this.children[b].mz*a+this.children[b].my*c,this.children[b].my=f,this.children[b].mz=g}if(this.rotationMY){a=
Math.cos(this.rotationMY);c=Math.sin(this.rotationMY);for(b=0;b<this.children.length;b++)d=this.children[b].mx*a-this.children[b].mz*c,g=this.children[b].mz*a+this.children[b].mx*c,this.children[b].mx=d,this.children[b].mz=g}if(this.rotationMZ){a=Math.cos(this.rotationMZ);c=Math.sin(this.rotationMZ);for(b=0;b<this.children.length;b++)d=this.children[b].mx*a-this.children[b].my*c,f=this.children[b].my*a+this.children[b].mx*c,this.children[b].mx=d,this.children[b].my=f}for(b=0;b<this.children.length;b++)this.children[b].rotateM()};
DepthKit.Container.prototype.scaleM=function(){};DepthKit.Container.prototype.translateM=function(){this.mx+=this.parent.mx;this.my+=this.parent.my;this.mz+=this.parent.mz;for(var a=0;a<this.children.length;a++)this.children[a].translateM()};DepthKit.Scene=function(){DepthKit.Container.call(this,0,0,0);this.meshes=[];this.scene=this};DepthKit.Scene.prototype=new DepthKit.Container;DepthKit.Scene.prototype.constructor=DepthKit.Scene;DepthKit.Scene.prototype.setScene=function(){};
DepthKit.Scene.prototype.initM=function(){for(var a=this.mz=this.my=this.mx=0;a<this.children.length;a++)this.children[a].initM()};DepthKit.Scene.prototype.rotateM=function(){for(var a=this.rotationMZ=this.rotationMY=this.rotationMX=0;a<this.children.length;a++)this.children[a].rotateM()};DepthKit.Scene.prototype.scaleM=function(){};DepthKit.Scene.prototype.translateM=function(){for(var a=0;a<this.children.length;a++)this.children[a].translateM()};
DepthKit.Camera=function(){this.y=this.x=0;this.z=-650;this.ey=this.ex=this.rotationZ=this.rotationY=this.rotationX=0;this.ez=650;this.step=void 0};DepthKit.Light=function(a,c,b,d){this.x=void 0===a?-100:a;this.y=void 0===c?-100:c;this.z=void 0===b?-100:b;this.brightness=void 0===d?1:Math.min(Math.max(d,0),1);this.step=void 0};DepthKit.Light.prototype.setBrightness=function(a){this.brightness=Math.min(Math.max(a,0),1)};
DepthKit.Viewport=function(){this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.canvas.width=480;this.canvas.height=320;this.vpX=240;this.vpY=160};DepthKit.Viewport.prototype.fillPage=function(a){this.canvas.width=window.innerWidth;this.canvas.height=window.innerHeight;this.vpX=this.canvas.width/2;this.vpY=this.canvas.height/2;this.canvas.style.position="absolute";this.canvas.style.zIndex=a||"auto";document.body.appendChild(this.canvas)};
DepthKit.Viewport.prototype.fillElement=function(a,c){var b=document.getElementById(a);this.canvas.width=Number((""+b.style.width).replace("px",""));this.canvas.height=Number((""+b.style.height).replace("px",""));this.vpX=this.canvas.width/2;this.vpY=this.canvas.height/2;this.canvas.style.position="relative";this.canvas.style.zIndex=c||"auto";b.appendChild(this.canvas)};DepthKit.Viewport.prototype.setBackgroundcolor=function(a){this.canvas.style.background=a};
DepthKit.Fog=function(a,c){this.depth=c||3E3;this.color=a||"#ffffff";var b=window.parseInt(this.color.slice(1),16);this.aColor="rgba("+(b>>16)+", "+(b>>8&255)+", "+(b&255)+", 0.20)";this.lastZ=this.depth};DepthKit.Fog.prototype.init=function(a){a.context.save();a.context.fillStyle=this.color;a.context.fillRect(0,0,a.canvas.width,a.canvas.height);a.context.restore()};
DepthKit.Fog.prototype.update=function(a,c){c.context.save();c.context.fillStyle=this.aColor;for(this.lastZ=this.lastZ;this.lastZ>a&&0<this.lastZ;this.lastZ-=this.depth/20)c.context.fillRect(0,0,c.canvas.width,c.canvas.height);c.context.restore()};DepthKit.Fog.prototype.finish=function(a){this.update(0,a);this.lastZ=this.depth};DepthKit.Renderer=function(a,c,b){this.scene=c||new DeptKit.Scene;this.camera=b||new DepthKit.Camera;this.viewport=a||new DepthKit.Viewport;this.fog=void 0};
DepthKit.Renderer.prototype.render=function(){this.scene.initM();this.scene.rotateM();this.scene.translateM();for(var a=Math.cos(this.camera.rotationX*DK.rad),c=Math.sin(this.camera.rotationX*DK.rad),b=Math.cos(this.camera.rotationY*DK.rad),d=Math.sin(this.camera.rotationY*DK.rad),f=Math.cos(this.camera.rotationZ*DK.rad),g=Math.sin(this.camera.rotationZ*DK.rad),e=0;e<this.scene.meshes.length;e++){this.scene.meshes[e].d=16777215;for(var h=0;h<this.scene.meshes[e].vertices.length;h++){var j=this.scene.meshes[e].vertices[h].mx-
this.camera.x,k=this.scene.meshes[e].vertices[h].my-this.camera.y,l=this.scene.meshes[e].vertices[h].mz-this.camera.z,m=g*k+f*j,i=b*l+d*m,n=f*k-g*j,o=c*i+a*n,i=a*i-c*n;this.scene.meshes[e].vertices[h].px=this.viewport.vpX+(b*m-d*l-this.camera.ex)*(this.camera.ez/i);this.scene.meshes[e].vertices[h].py=this.viewport.vpY+(o-this.camera.ey)*(this.camera.ez/i);this.scene.meshes[e].vertices[h].pz=i;this.scene.meshes[e].vertices[h].d=Math.sqrt(j*j+k*k+l*l);this.scene.meshes[e].d=Math.min(this.scene.meshes[e].d,
this.scene.meshes[e].vertices[h].d)}}this.scene.meshes.sort(DK.meshSort);if(void 0!==this.fog){this.fog.init(this.viewport);for(e=0;e<this.scene.meshes.length;e++)this.scene.meshes[e].d<this.fog.depth&&(this.fog.update(this.scene.meshes[e].d,this.viewport),this.scene.meshes[e].draw(this.viewport.context));this.fog.finish(this.viewport)}else for(e=0;e<this.scene.meshes.length;e++)this.scene.meshes[e].draw(this.viewport.context)};
if(!window.requestAnimationFrame)window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(a){return window.setTimeout(a,17)};if(!window.cancelRequestAnimationFrame)window.cancelRequestAnimationFrame=window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.clearTimeout;
DepthKit.startTime=(new Date).getTime();DepthKit.getTimer=function(){return(new Date).getTime()-DepthKit.startTime};DepthKit.key={};
DepthKit.key.startCapturing=function(){DepthKit.key.down={UP:!1,DOWN:!1,LEFT:!1,RIGHT:!1,X:!1,C:!1,SPACE:!1};DepthKit.key.pressed={UP:!1,DOWN:!1,LEFT:!1,RIGHT:!1,X:!1,C:!1,SPACE:!1};DepthKit.key.unsetPressed=function(){DepthKit.key.pressed.UP=!1;DepthKit.key.pressed.DOWN=!1;DepthKit.key.pressed.LEFT=!1;DepthKit.key.pressed.RIGHT=!1;DepthKit.key.pressed.X=!1;DepthKit.key.pressed.C=!1;DepthKit.key.pressed.SPACE=!1};DepthKit.key.onKD=function(a){switch(a.keyCode){case 38:if(!DepthKit.key.down.UP)DepthKit.key.pressed.UP=
!0,DepthKit.key.down.UP=!0;break;case 40:if(!DepthKit.key.down.DOWN)DepthKit.key.pressed.DOWN=!0,DepthKit.key.down.DOWN=!0;break;case 37:if(!DepthKit.key.down.LEFT)DepthKit.key.pressed.LEFT=!0,DepthKit.key.down.LEFT=!0;break;case 39:if(!DepthKit.key.down.RIGHT)DepthKit.key.pressed.RIGHT=!0,DepthKit.key.down.RIGHT=!0;break;case 88:DepthKit.key.down.X=!0;if(!DepthKit.key.down.X)DepthKit.key.pressed.X=!0,DepthKit.key.down.X=!0;break;case 67:if(!DepthKit.key.down.C)DepthKit.key.pressed.C=!0,DepthKit.key.down.C=
!0;break;case 32:if(!DepthKit.key.down.SPACE)DepthKit.key.pressed.SPACE=!0,DepthKit.key.down.SPACE=!0}};DepthKit.key.onKU=function(a){switch(a.keyCode){case 38:DepthKit.key.down.UP=!1;break;case 40:DepthKit.key.down.DOWN=!1;break;case 37:DepthKit.key.down.LEFT=!1;break;case 39:DepthKit.key.down.RIGHT=!1;break;case 88:DepthKit.key.down.X=!1;break;case 67:DepthKit.key.down.C=!1;break;case 32:DepthKit.key.down.SPACE=!1}};window.addEventListener("keydown",DepthKit.key.onKD,!1);window.addEventListener("keyup",
DepthKit.key.onKU,!1);DepthKit.key.stopCapturing=function(){window.removeEventListener("keydown",DepthKit.key.onKD,!1);window.removeEventListener("keyup",DepthKit.key.onKU,!1);delete DepthKit.key.down;delete DepthKit.key.pressed;delete DepthKit.key.unsetPressed;delete DepthKit.key.onKD;delete DepthKit.key.onKU}};DepthKit.mouse={};
DepthKit.mouse.attachTo=function(a){var c={x:0,y:0,event:null};a.mousemove=function(b){var d,f;b.pageX||b.pageY?(d=b.pageX,f=b.pageY):(d=b.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,f=b.clientY+document.body.scrollTop+document.documentElement.scrollTop);d-=a.canvas.offsetLeft;f-=a.canvas.offsetTop;c.x=d;c.y=f;c.event=b};a.canvas.addEventListener("mousemove",a.mousemove,!1);a.touchmove=function(b){b.preventDefault();var d,f;b.touches[0].pageX||b.touches[0].pageY?(d=b.touches[0].pageX,
f=b.touches[0].pageY):(d=b.touches[0].clientX+document.body.scrollLeft+document.documentElement.scrollLeft,f=b.touches[0].clientY+document.body.scrollTop+document.documentElement.scrollTop);d-=a.canvas.offsetLeft;f-=a.canvas.offsetTop;c.x=d;c.y=f;c.event=b};a.canvas.addEventListener("touchmove",a.touchmove,!1);a.mouse=c};
DepthKit.mouse.detachFrom=function(a){a.canvas.removeEventListener("mousemove",a.mousemove,!1);a.canvas.removeEventListener("touchmove",a.touchmove,!1);delete a.mouse;delete a.mousemove;delete a.touchmove};
DepthKit.Engine=function(){this.scene=new DepthKit.Scene;this.camera=new DepthKit.Camera;this.light=new DepthKit.Light;this.viewport=new DepthKit.Viewport;this.renderer=new DepthKit.Renderer(this.viewport,this.scene,this.camera);this.time=DepthKit.getTimer();this.elapsed=DepthKit.getTimer()-this.time;this.paintMode=!1};DepthKit.Engine.prototype.step=function(a){if(void 0!==a.children)for(var c=0;c<a.children.length;c++)this.step(a.children[c]);void 0!==a.step&&"function"===typeof a.step&&a.step()};
DepthKit.Engine.prototype.start=function(){this.time=DepthKit.getTimer();this.elapsed=DepthKit.getTimer()-this.time;var a=this;(function b(){frameID=window.requestAnimationFrame(b,a.viewport.canvas);a.elapsed=DepthKit.getTimer()-a.time;a.time=DepthKit.getTimer();a.paintMode||a.viewport.context.clearRect(0,0,a.viewport.canvas.width,a.viewport.canvas.height);a.step(a.scene);a.step(a.light);a.step(a.camera);a.renderer.render();void 0!==DepthKit.key.pressed&&DepthKit.key.unsetPressed()})()};
DepthKit.Engine.prototype.stop=function(){window.cancelRequestAnimationFrame(frameID)};
DepthKit.Cube=function(){DepthKit.Mesh.call(this,0,0,0);var a,c,b;switch(arguments.length){case 1:a=c=b=arguments[0]/2;break;case 2:a=b=arguments[0]/2;c=arguments[1]/2;break;case 3:a=arguments[0]/2;c=arguments[1]/2;b=arguments[2]/2;break;default:a=c=b=50}this.addVertex(-a,c,-b);this.addVertex(a,c,-b);this.addVertex(a,-c,-b);this.addVertex(-a,-c,-b);this.addVertex(-a,c,b);this.addVertex(a,c,b);this.addVertex(a,-c,b);this.addVertex(-a,-c,b);this.addFace(this.vertices[1],this.vertices[5],this.vertices[4],
"#ff0000");this.addFace(this.vertices[0],this.vertices[1],this.vertices[4],"#ff0000");this.addFace(this.vertices[6],this.vertices[2],this.vertices[3],"#00ff00");this.addFace(this.vertices[7],this.vertices[6],this.vertices[3],"#00ff00");this.addFace(this.vertices[3],this.vertices[0],this.vertices[4],"#0000ff");this.addFace(this.vertices[7],this.vertices[3],this.vertices[4],"#0000ff");this.addFace(this.vertices[2],this.vertices[5],this.vertices[1],"#ffff00");this.addFace(this.vertices[6],this.vertices[5],
this.vertices[2],"#ffff00");this.addFace(this.vertices[6],this.vertices[4],this.vertices[5],"#00ffff");this.addFace(this.vertices[6],this.vertices[7],this.vertices[4],"#00ffff");this.addFace(this.vertices[2],this.vertices[1],this.vertices[0],"#ff00ff");this.addFace(this.vertices[3],this.vertices[2],this.vertices[0],"#ff00ff")};DepthKit.Cube.prototype=new DepthKit.Mesh;DepthKit.Cube.prototype.constructor=DepthKit.Cube;DepthKit.ObjModel=function(){DepthKit.Mesh.call(this,0,0,0);this.scale=1};
DepthKit.ObjModel.prototype=new DepthKit.Mesh;DepthKit.ObjModel.prototype.constructor=DepthKit.ObjModel;
DepthKit.ObjModel.prototype.parseFile=function(a,c){if(void 0!==a){this.scale=c||100;var b=this,d=new XMLHttpRequest;d.open("GET",a,!0);d.onreadystatechange=function(){if(4===d.readyState&&200===d.status){for(var a=d.responseText.split("\n"),c=0;c<a.length;c++){var e=a[c].split(" ");"v"===e[0]?b.addVertex(e[1]*b.scale,e[2]*b.scale,e[3]*b.scale):"f"===e[0]&&b.addFace(b.vertices[e[3].split("/")[0]-1],b.vertices[e[2].split("/")[0]-1],b.vertices[e[1].split("/")[0]-1])}b.onParsed()}};d.send(null)}};
DepthKit.ObjModel.prototype.onParsed=function(){};
